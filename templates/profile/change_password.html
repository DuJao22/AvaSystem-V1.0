{% extends "base.html" %}

{% block title %}Alterar Senha - Sistema TEA{% endblock %}

{% block content %}
<div class="px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="sm:flex sm:items-center">
        <div class="sm:flex-auto">
            <h1 class="text-2xl font-semibold text-gray-900">Alterar Senha</h1>
            <p class="mt-2 text-sm text-gray-700">
                Atualize sua senha para manter sua conta segura
            </p>
        </div>
        <div class="mt-4 sm:mt-0 sm:ml-16 sm:flex-none">
            <a href="{{ url_for('profile.index') }}" 
               class="btn-secondary">
                <i data-feather="arrow-left" class="w-4 h-4 mr-2"></i>
                Voltar
            </a>
        </div>
    </div>

    <!-- Change Password Form -->
    <div class="mt-8 bg-white shadow sm:rounded-lg">
        <form method="POST" class="space-y-6">
            <div class="px-4 py-5 sm:p-6">
                <!-- Security Notice -->
                <div class="mb-6 bg-blue-50 border border-blue-200 rounded-md p-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i data-feather="info" class="w-5 h-5 text-blue-400"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-blue-800">
                                Dicas de Segurança
                            </h3>
                            <div class="mt-2 text-sm text-blue-700">
                                <ul class="list-disc list-inside space-y-1">
                                    <li>Use pelo menos 8 caracteres</li>
                                    <li>Combine letras, números e símbolos</li>
                                    <li>Evite informações pessoais óbvias</li>
                                    <li>Não reutilize senhas de outras contas</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Current Password -->
                <div class="mb-6">
                    <label for="senha_atual" class="block text-sm font-medium text-gray-700">
                        Senha Atual <span class="text-red-500">*</span>
                    </label>
                    <div class="mt-2">
                        <input type="password" 
                               name="senha_atual" 
                               id="senha_atual" 
                               required
                               autocomplete="current-password"
                               class="form-input">
                    </div>
                </div>

                <!-- New Password -->
                <div class="mb-6">
                    <label for="nova_senha" class="block text-sm font-medium text-gray-700">
                        Nova Senha <span class="text-red-500">*</span>
                    </label>
                    <div class="mt-2">
                        <input type="password" 
                               name="nova_senha" 
                               id="nova_senha" 
                               required
                               minlength="6"
                               autocomplete="new-password"
                               class="form-input">
                        <p class="mt-2 text-xs text-gray-500">
                            Mínimo de 6 caracteres
                        </p>
                    </div>
                </div>

                <!-- Confirm New Password -->
                <div class="mb-6">
                    <label for="confirmar_senha" class="block text-sm font-medium text-gray-700">
                        Confirmar Nova Senha <span class="text-red-500">*</span>
                    </label>
                    <div class="mt-2">
                        <input type="password" 
                               name="confirmar_senha" 
                               id="confirmar_senha" 
                               required
                               minlength="6"
                               autocomplete="new-password"
                               class="form-input">
                    </div>
                    <p id="password-match-message" class="mt-2 text-xs hidden"></p>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="px-4 py-3 bg-gray-50 text-right sm:px-6 space-x-3">
                <a href="{{ url_for('profile.index') }}" 
                   class="btn-secondary">
                    Cancelar
                </a>
                <button type="submit" 
                        id="submit-btn"
                        class="btn-primary">
                    <i data-feather="lock" class="w-4 h-4 mr-2"></i>
                    Alterar Senha
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// Password confirmation validation
document.addEventListener('DOMContentLoaded', function() {
    const novaSenha = document.getElementById('nova_senha');
    const confirmarSenha = document.getElementById('confirmar_senha');
    const message = document.getElementById('password-match-message');
    const submitBtn = document.getElementById('submit-btn');

    function validatePasswords() {
        if (confirmarSenha.value === '') {
            message.classList.add('hidden');
            return;
        }

        if (novaSenha.value === confirmarSenha.value) {
            message.textContent = 'As senhas coincidem';
            message.className = 'mt-2 text-xs text-green-600';
            submitBtn.disabled = false;
            submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        } else {
            message.textContent = 'As senhas não coincidem';
            message.className = 'mt-2 text-xs text-red-600';
            submitBtn.disabled = true;
            submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }
    }

    novaSenha.addEventListener('input', validatePasswords);
    confirmarSenha.addEventListener('input', validatePasswords);

    // Password strength indicator
    novaSenha.addEventListener('input', function() {
        const password = novaSenha.value;
        const strength = getPasswordStrength(password);
        // You could add a visual strength indicator here
    });

    function getPasswordStrength(password) {
        let strength = 0;
        if (password.length >= 8) strength++;
        if (/[a-z]/.test(password)) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^A-Za-z0-9]/.test(password)) strength++;
        return strength;
    }
});
</script>
{% endblock %}